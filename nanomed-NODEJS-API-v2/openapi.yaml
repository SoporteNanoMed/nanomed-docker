openapi: 3.0.3
info:
  title: Nanomed API v2
  description: |
    API REST para el sistema Nanomed - Gesti√≥n m√©dica y administrativa integral
    
    ## Caracter√≠sticas Principales
    - üîê Autenticaci√≥n JWT con MFA
    - üë• Sistema de roles multinivel (Usuario, M√©dico, Recepcionista, Admin)
    - üè• Gesti√≥n completa de citas m√©dicas
    - üìÖ Sistema de horarios m√©dicos configurables
    - üî¨ Gesti√≥n de ex√°menes m√©dicos
    - üìä Reportes y estad√≠sticas en tiempo real
    - üîî Notificaciones autom√°ticas
    
    ## Roles de Usuario
    - **user** - Usuario/Paciente: Gesti√≥n personal de citas y ex√°menes
    - **medico** - M√©dico: Gesti√≥n de pacientes y ex√°menes m√©dicos
    - **recepcionista** - Recepcionista: Gesti√≥n integral de citas y pacientes
    - **admin** - Administrador: Control total del sistema
    
    **NOTA**: Los endpoints de conversaciones/mensajer√≠a han sido eliminados del proyecto.
  version: 2.2.0
  contact:
    name: Soporte Nanomed
    email: soporte@nanomed.cl
    url: https://nanomed.cl
  license:
    name: Privado y Confidencial
    url: https://nanomed.cl/license

servers:
  - url: http://localhost:4000
    description: Servidor de desarrollo
  - url: https://nanomed-nodejs-api-v2.azurewebsites.net
    description: Servidor de producci√≥n

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT obtenido del endpoint de login

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        nombre:
          type: string
        apellido:
          type: string
        email:
          type: string
          format: email
        telefono:
          type: string
        rut:
          type: string
        role:
          type: string
          enum: [user, medico, recepcionista, admin]
        email_verified:
          type: boolean
        genero:
          type: string
          enum: [Masculino, Femenino, Otro]
        direccion:
          type: string
        ciudad:
          type: string
        region:
          type: string
        foto_perfil:
          type: string
        creado_en:
          type: string
          format: date-time

    ApiResponse:
      type: object
      properties:
        error:
          type: boolean
        status:
          type: integer
        body:
          type: object
        message:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    RegisterRequest:
      type: object
      required: [nombre, apellido, email, password, rut]
      properties:
        nombre:
          type: string
        apellido:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        rut:
          type: string
        telefono:
          type: string
        genero:
          type: string
        direccion:
          type: string
        ciudad:
          type: string
        region:
          type: string
        fecha_nacimiento:
          type: string
          format: date

paths:
  # ====== AUTENTICACI√ìN ======
  /api/auth/register:
    post:
      tags: [Autenticaci√≥n]
      summary: Registrar nuevo usuario
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Usuario registrado exitosamente
        '400':
          description: Error en los datos

  /api/auth/login:
    post:
      tags: [Autenticaci√≥n]
      summary: Iniciar sesi√≥n
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login exitoso
        '401':
          description: Credenciales inv√°lidas

  /api/auth/logout:
    post:
      tags: [Autenticaci√≥n]
      summary: Cerrar sesi√≥n
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Sesi√≥n cerrada exitosamente

  /api/auth/verify-email/{token}:
    get:
      tags: [Autenticaci√≥n]
      summary: Verificar email
      security: []
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Email verificado exitosamente

  /api/auth/forgot-password:
    post:
      tags: [Autenticaci√≥n]
      summary: Solicitar restablecimiento de contrase√±a
      security: []
      responses:
        '200':
          description: Email de restablecimiento enviado

  /api/auth/reset-password:
    post:
      tags: [Autenticaci√≥n]
      summary: Restablecer contrase√±a
      security: []
      responses:
        '200':
          description: Contrase√±a restablecida exitosamente

  /api/auth/check-password-strength:
    post:
      tags: [Autenticaci√≥n]
      summary: Verificar fortaleza de contrase√±a
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
      responses:
        '200':
          description: An√°lisis de fortaleza de contrase√±a

  # ====== GESTI√ìN DE USUARIOS ======
  /api/users/me:
    get:
      tags: [Usuarios]
      summary: Obtener perfil propio
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Perfil del usuario
    put:
      tags: [Usuarios]
      summary: Actualizar perfil propio
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Perfil actualizado correctamente

  /api/users/me/password:
    put:
      tags: [Usuarios]
      summary: Cambiar contrase√±a
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Contrase√±a actualizada

  /api/users/me/profile-picture:
    post:
      tags: [Usuarios]
      summary: Subir foto de perfil
      security:
        - bearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                profilePhoto:
                  type: string
                  format: binary
      responses:
        '200':
          description: Foto subida exitosamente
    delete:
      tags: [Usuarios]
      summary: Eliminar foto de perfil
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Foto eliminada exitosamente

  /api/users/me/emergency-contacts:
    get:
      tags: [Usuarios]
      summary: Listar contactos de emergencia
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de contactos de emergencia
    post:
      tags: [Usuarios]
      summary: Agregar contacto de emergencia
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Contacto agregado exitosamente

  /api/users/me/emergency-contacts/{id}:
    put:
      tags: [Usuarios]
      summary: Actualizar contacto de emergencia
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Contacto actualizado
    delete:
      tags: [Usuarios]
      summary: Eliminar contacto de emergencia
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Contacto eliminado

  /api/users/me/medical-info:
    get:
      tags: [Usuarios]
      summary: Obtener informaci√≥n m√©dica
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Informaci√≥n m√©dica del usuario
    put:
      tags: [Usuarios]
      summary: Actualizar informaci√≥n m√©dica
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Informaci√≥n m√©dica actualizada

  # ====== M√âDICOS ======
  /api/doctors:
    get:
      tags: [M√©dicos]
      summary: Listar m√©dicos disponibles
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de m√©dicos

  /api/doctors/{id}:
    get:
      tags: [M√©dicos]
      summary: Obtener m√©dico espec√≠fico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Informaci√≥n del m√©dico

  /api/doctors/specialties/{specialtyId}:
    get:
      tags: [M√©dicos]
      summary: M√©dicos por especialidad
      security:
        - bearerAuth: []
      parameters:
        - name: specialtyId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: M√©dicos de la especialidad

  /api/doctors/me/appointments:
    get:
      tags: [M√©dicos]
      summary: Listar mis citas como m√©dico
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de citas del m√©dico

  /api/doctors/me/appointments/{id}:
    get:
      tags: [M√©dicos]
      summary: Obtener detalle de mi cita espec√≠fica
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalle de la cita

  /api/doctors/me/appointments/{id}/status:
    put:
      tags: [M√©dicos]
      summary: Actualizar estado de mi cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Estado de cita actualizado

  # ====== CITAS M√âDICAS ======
  /api/appointments:
    get:
      tags: [Citas]
      summary: Listar citas propias
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de citas del usuario
    post:
      tags: [Citas]
      summary: Crear nueva cita
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Cita creada exitosamente

  /api/appointments/available-slots:
    get:
      tags: [Citas]
      summary: Obtener horarios disponibles
      security:
        - bearerAuth: []
      parameters:
        - name: medico_id
          in: query
          schema:
            type: integer
        - name: fecha
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Horarios disponibles

  /api/appointments/{id}:
    put:
      tags: [Citas]
      summary: Actualizar cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Cita actualizada
    delete:
      tags: [Citas]
      summary: Cancelar cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Cita cancelada

  /api/appointments/{id}/confirm:
    post:
      tags: [Citas]
      summary: Confirmar asistencia a cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Asistencia confirmada

  /api/appointments/{id}/reschedule:
    post:
      tags: [Citas]
      summary: Reprogramar cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nueva_fecha_hora:
                  type: string
                  format: date-time
      responses:
        '200':
          description: Cita reprogramada

  # ====== RECEPCIONISTAS ======
  /api/receptionists/appointments:
    get:
      tags: [Recepcionistas]
      summary: Listar todas las citas
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de todas las citas
    post:
      tags: [Recepcionistas]
      summary: Crear cita para cualquier paciente
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Cita creada

  /api/receptionists/appointments/{id}:
    put:
      tags: [Recepcionistas]
      summary: Actualizar cualquier cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Cita actualizada
    delete:
      tags: [Recepcionistas]
      summary: Cancelar cualquier cita
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Cita cancelada

  /api/receptionists/patients:
    get:
      tags: [Recepcionistas]
      summary: Listar todos los pacientes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de pacientes

  /api/receptionists/patients/{id}:
    get:
      tags: [Recepcionistas]
      summary: Informaci√≥n detallada de paciente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Informaci√≥n del paciente

  /api/receptionists/doctors:
    get:
      tags: [Recepcionistas]
      summary: Listar todos los m√©dicos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de m√©dicos

  /api/receptionists/doctors/{id}/availability:
    get:
      tags: [Recepcionistas]
      summary: Disponibilidad de m√©dico (legacy)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fecha
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Disponibilidad del m√©dico

  /api/receptionists/doctors/{id}/availability-updated:
    get:
      tags: [Recepcionistas]
      summary: Disponibilidad actualizada (usando horarios configurados)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fecha
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Disponibilidad basada en horarios configurados

  # ====== GESTI√ìN DE BLOQUES DE DISPONIBILIDAD (NUEVA ESTRUCTURA FLEXIBLE) ======
  /api/receptionists/doctors/{id}/availability-blocks:
    post:
      tags: [Bloques de Disponibilidad]
      summary: Crear bloques espec√≠ficos de disponibilidad
      description: |
        Crear bloques individuales de 30 minutos para fechas y horas espec√≠ficas.
        Este sistema reemplaza los horarios semanales r√≠gidos por un sistema flexible
        donde cada bloque representa un slot disponible espec√≠fico.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del m√©dico
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                bloques:
                  type: array
                  items:
                    type: object
                    properties:
                      fecha_hora_inicio:
                        type: string
                        format: date-time
                        example: "2024-01-22T09:00:00"
                      fecha_hora_fin:
                        type: string
                        format: date-time
                        example: "2024-01-22T09:30:00"
                        description: "Opcional, por defecto 30 minutos despu√©s del inicio"
                      disponible:
                        type: boolean
                        default: true
                        description: "Si el bloque est√° disponible para citas"
            examples:
              bloques_especificos:
                summary: Bloques espec√≠ficos
                value:
                  bloques:
                    - fecha_hora_inicio: "2024-01-22T09:00:00"
                      fecha_hora_fin: "2024-01-22T09:30:00"
                    - fecha_hora_inicio: "2024-01-22T10:00:00"
                      fecha_hora_fin: "2024-01-22T10:30:00"
                    - fecha_hora_inicio: "2024-01-23T14:00:00"
                      fecha_hora_fin: "2024-01-23T14:30:00"
      responses:
        '201':
          description: Bloques creados exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: boolean
                  status:
                    type: integer
                  body:
                    type: object
                    properties:
                      medico:
                        type: object
                      bloques_creados:
                        type: array
                      mensaje:
                        type: string
    get:
      tags: [Bloques de Disponibilidad]
      summary: Obtener bloques de disponibilidad
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fecha_inicio
          in: query
          schema:
            type: string
            format: date
          example: "2024-01-22"
        - name: fecha_fin
          in: query
          schema:
            type: string
            format: date
          example: "2024-01-28"
      responses:
        '200':
          description: Bloques de disponibilidad obtenidos
    delete:
      tags: [Bloques de Disponibilidad]
      summary: Eliminar bloques de disponibilidad
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fecha
          in: query
          schema:
            type: string
            format: date
          description: "Eliminar todos los bloques de una fecha espec√≠fica"
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
        - name: bloque_ids
          in: query
          schema:
            type: string
          description: "IDs espec√≠ficos separados por coma: 1,2,3"
        - name: solo_disponibles
          in: query
          schema:
            type: boolean
          description: "Solo eliminar bloques disponibles (sin citas)"
      responses:
        '200':
          description: Bloques eliminados exitosamente

  /api/receptionists/doctors/{id}/availability-blocks/generate:
    post:
      tags: [Bloques de Disponibilidad]
      summary: Generar bloques autom√°ticamente
      description: |
        Generar bloques de disponibilidad de forma autom√°tica para un rango de fechas
        con configuraci√≥n flexible de d√≠as, horarios y excepciones.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [fecha_inicio, fecha_fin]
              properties:
                fecha_inicio:
                  type: string
                  format: date
                  example: "2024-01-22"
                fecha_fin:
                  type: string
                  format: date
                  example: "2024-01-28"
                dias_semana:
                  type: array
                  items:
                    type: integer
                    minimum: 0
                    maximum: 6
                  example: [1, 2, 3, 4, 5]
                  description: "0=Domingo, 1=Lunes... 6=S√°bado"
                hora_inicio:
                  type: string
                  format: time
                  example: "09:00"
                hora_fin:
                  type: string
                  format: time
                  example: "17:00"
                duracion_bloque:
                  type: integer
                  default: 30
                  description: "Duraci√≥n en minutos"
                excluir_fechas:
                  type: array
                  items:
                    type: string
                    format: date
                  example: ["2024-01-25"]
                  description: "Fechas espec√≠ficas a excluir"
            examples:
              semana_completa:
                summary: Semana laboral completa
                value:
                  fecha_inicio: "2024-01-22"
                  fecha_fin: "2024-01-26"
                  dias_semana: [1, 2, 3, 4, 5]
                  hora_inicio: "09:00"
                  hora_fin: "17:00"
                  duracion_bloque: 30
              horario_personalizado:
                summary: Horario personalizado con excepciones
                value:
                  fecha_inicio: "2024-01-22"
                  fecha_fin: "2024-02-22"
                  dias_semana: [1, 3, 5]
                  hora_inicio: "14:00"
                  hora_fin: "18:00"
                  duracion_bloque: 30
                  excluir_fechas: ["2024-01-25", "2024-02-01"]
      responses:
        '201':
          description: Bloques generados exitosamente

  /api/receptionists/availability-blocks/{bloqueId}/disable:
    put:
      tags: [Bloques de Disponibilidad]
      summary: Marcar bloque como no disponible
      security:
        - bearerAuth: []
      parameters:
        - name: bloqueId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                motivo:
                  type: string
                  example: "Reuni√≥n m√©dica"
      responses:
        '200':
          description: Bloque marcado como no disponible

  /api/receptionists/availability-blocks/{bloqueId}/enable:
    put:
      tags: [Bloques de Disponibilidad]
      summary: Marcar bloque como disponible
      security:
        - bearerAuth: []
      parameters:
        - name: bloqueId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Bloque marcado como disponible

  # ====== GESTI√ìN DE HORARIOS M√âDICOS ======
  /api/receptionists/doctors/{id}/schedule:
    post:
      tags: [Horarios M√©dicos]
      summary: Establecer horarios regulares del m√©dico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                horarios:
                  type: array
                  items:
                    type: object
                    properties:
                      dia_semana:
                        type: integer
                        minimum: 0
                        maximum: 6
                      hora_inicio:
                        type: string
                        format: time
                      hora_fin:
                        type: string
                        format: time
                      duracion_cita:
                        type: integer
                        default: 30
      responses:
        '201':
          description: Horarios establecidos exitosamente
    get:
      tags: [Horarios M√©dicos]
      summary: Consultar horarios configurados del m√©dico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Horarios configurados del m√©dico

  /api/receptionists/doctors/{id}/schedule/{scheduleId}:
    put:
      tags: [Horarios M√©dicos]
      summary: Actualizar horario espec√≠fico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: scheduleId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Horario actualizado
    delete:
      tags: [Horarios M√©dicos]
      summary: Eliminar horario espec√≠fico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: scheduleId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Horario eliminado

  /api/receptionists/doctors/{id}/schedule/exceptions:
    post:
      tags: [Horarios M√©dicos]
      summary: Agregar excepci√≥n de horario
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fecha:
                  type: string
                  format: date
                motivo:
                  type: string
                todo_el_dia:
                  type: boolean
                  default: true
                hora_inicio:
                  type: string
                  format: time
                hora_fin:
                  type: string
                  format: time
      responses:
        '201':
          description: Excepci√≥n agregada
    get:
      tags: [Horarios M√©dicos]
      summary: Listar excepciones del m√©dico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Lista de excepciones

  /api/receptionists/doctors/{id}/schedule/exceptions/{exceptionId}:
    delete:
      tags: [Horarios M√©dicos]
      summary: Eliminar excepci√≥n
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: exceptionId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Excepci√≥n eliminada

  /api/receptionists/stats/daily:
    get:
      tags: [Recepcionistas]
      summary: Estad√≠sticas diarias
      security:
        - bearerAuth: []
      parameters:
        - name: fecha
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Estad√≠sticas del d√≠a

  # ====== EX√ÅMENES M√âDICOS ======
  /api/exams:
    get:
      tags: [Ex√°menes]
      summary: Listar ex√°menes
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de ex√°menes
    post:
      tags: [Ex√°menes]
      summary: Crear nuevo examen
      security:
        - bearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                archivo:
                  type: string
                  format: binary
      responses:
        '201':
          description: Examen creado

  /api/exams/{id}:
    get:
      tags: [Ex√°menes]
      summary: Obtener examen espec√≠fico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Informaci√≥n del examen
    put:
      tags: [Ex√°menes]
      summary: Actualizar examen
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Examen actualizado
    delete:
      tags: [Ex√°menes]
      summary: Eliminar examen
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Examen eliminado

  /api/exams/{id}/file:
    get:
      tags: [Ex√°menes]
      summary: Descargar archivo de examen
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Archivo del examen

  # ====== ESPECIALIDADES ======
  /api/specialties:
    get:
      tags: [Especialidades]
      summary: Listar especialidades m√©dicas
      security: []
      responses:
        '200':
          description: Lista de especialidades

  /api/specialties/stats:
    get:
      tags: [Especialidades]
      summary: Estad√≠sticas de especialidades
      security: []
      responses:
        '200':
          description: Estad√≠sticas de especialidades

  /api/specialties/{nombre}:
    get:
      tags: [Especialidades]
      summary: Informaci√≥n de especialidad espec√≠fica
      security: []
      parameters:
        - name: nombre
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Informaci√≥n de la especialidad

  # ====== B√öSQUEDAS ======
  /api/search/doctors:
    get:
      tags: [B√∫squedas]
      summary: Buscar m√©dicos
      security:
        - bearerAuth: []
      parameters:
        - name: especialidad
          in: query
          schema:
            type: string
        - name: nombre
          in: query
          schema:
            type: string
        - name: apellido
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Resultados de b√∫squeda

  /api/search/exams:
    get:
      tags: [B√∫squedas]
      summary: Buscar ex√°menes
      security:
        - bearerAuth: []
      parameters:
        - name: tipo_examen
          in: query
          schema:
            type: string
        - name: fecha_desde
          in: query
          schema:
            type: string
            format: date
        - name: fecha_hasta
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Resultados de b√∫squeda

  # ====== NOTIFICACIONES ======
  /api/notifications:
    get:
      tags: [Notificaciones]
      summary: Listar notificaciones del usuario
      security:
        - bearerAuth: []
      parameters:
        - name: limite
          in: query
          schema:
            type: integer
        - name: offset
          in: query
          schema:
            type: integer
        - name: leida
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de notificaciones

  /api/notifications/{id}/read:
    put:
      tags: [Notificaciones]
      summary: Marcar notificaci√≥n como le√≠da
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Notificaci√≥n marcada como le√≠da

  /api/notifications/read-all:
    put:
      tags: [Notificaciones]
      summary: Marcar todas las notificaciones como le√≠das
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Todas las notificaciones marcadas como le√≠das

  /api/notifications/{id}:
    delete:
      tags: [Notificaciones]
      summary: Eliminar notificaci√≥n
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Notificaci√≥n eliminada

  /api/notifications/preferences:
    get:
      tags: [Notificaciones]
      summary: Obtener preferencias de notificaci√≥n
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Preferencias de notificaci√≥n
    put:
      tags: [Notificaciones]
      summary: Actualizar preferencias de notificaci√≥n
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email_citas:
                  type: boolean
                email_resultados:
                  type: boolean
                email_promociones:
                  type: boolean
                sms_citas:
                  type: boolean
                sms_resultados:
                  type: boolean
      responses:
        '200':
          description: Preferencias actualizadas

  # ====== ADMINISTRACI√ìN ======
  /api/admin/users:
    get:
      tags: [Administraci√≥n]
      summary: Listar todos los usuarios
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de usuarios

  /api/admin/users/{id}:
    get:
      tags: [Administraci√≥n]
      summary: Ver detalle de usuario espec√≠fico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalle del usuario
    put:
      tags: [Administraci√≥n]
      summary: Actualizar datos de usuario
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Usuario actualizado
    delete:
      tags: [Administraci√≥n]
      summary: Desactivar usuario
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Usuario desactivado

  /api/admin/users/medico:
    post:
      tags: [Administraci√≥n]
      summary: Crear nuevo usuario m√©dico
      security:
        - bearerAuth: []
      responses:
        '201':
          description: M√©dico creado

  /api/admin/users/recepcionista:
    post:
      tags: [Administraci√≥n]
      summary: Crear nuevo recepcionista
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Recepcionista creado

  /api/admin/users/admin:
    post:
      tags: [Administraci√≥n]
      summary: Crear nuevo administrador
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Administrador creado

  /api/admin/doctors:
    get:
      tags: [Administraci√≥n]
      summary: Listar todos los m√©dicos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de m√©dicos
    post:
      tags: [Administraci√≥n]
      summary: Crear nuevo m√©dico
      security:
        - bearerAuth: []
      responses:
        '201':
          description: M√©dico creado

  /api/admin/doctors/{id}:
    delete:
      tags: [Administraci√≥n]
      summary: Desactivar m√©dico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: M√©dico desactivado

  /api/admin/doctors/migration/status:
    get:
      tags: [Administraci√≥n]
      summary: Estado de migraci√≥n
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estado de migraci√≥n

  /api/admin/doctors/migration/execute:
    post:
      tags: [Administraci√≥n]
      summary: Ejecutar migraci√≥n
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Migraci√≥n ejecutada

  /api/admin/recepcionistas:
    get:
      tags: [Administraci√≥n]
      summary: Listar recepcionistas
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de recepcionistas

  /api/admin/admin:
    get:
      tags: [Administraci√≥n]
      summary: Listar administradores
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de administradores

  /api/admin/stats:
    get:
      tags: [Administraci√≥n]
      summary: Estad√≠sticas generales del sistema
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estad√≠sticas del sistema

  /api/admin/logs:
    get:
      tags: [Administraci√≥n]
      summary: Obtener logs del sistema
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logs del sistema

  /api/admin/appointments:
    get:
      tags: [Administraci√≥n]
      summary: Ver todas las citas
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de todas las citas

tags:
  - name: Sistema
    description: Endpoints del sistema y estado de la API
  - name: Autenticaci√≥n
    description: Registro, login y gesti√≥n de autenticaci√≥n
  - name: Autenticaci√≥n MFA
    description: Autenticaci√≥n de dos factores (2FA)
  - name: Perfil de Usuario
    description: Gesti√≥n del perfil del usuario autenticado
  - name: Contactos de Emergencia
    description: Gesti√≥n de contactos de emergencia del usuario
  - name: Informaci√≥n M√©dica
    description: Gesti√≥n de informaci√≥n m√©dica personal
  - name: Usuarios (Legacy)
    description: Gesti√≥n legacy de usuarios (compatibilidad)
  - name: M√©dicos
    description: Consulta de informaci√≥n de m√©dicos disponibles
  - name: Especialidades
    description: Consulta de especialidades m√©dicas
  - name: Citas M√©dicas
    description: Gesti√≥n de citas m√©dicas para usuarios
  - name: Recepcionistas
    description: Funcionalidades espec√≠ficas para recepcionistas (gesti√≥n integral)
  - name: Ex√°menes M√©dicos
    description: Gesti√≥n completa de ex√°menes m√©dicos
  - name: Conversaciones
    description: Sistema de mensajer√≠a entre usuarios y m√©dicos
  - name: Notificaciones
    description: Gesti√≥n de notificaciones y preferencias
  - name: B√∫squeda
    description: Funcionalidades de b√∫squeda avanzada
  - name: Administraci√≥n
    description: Funcionalidades administrativas del sistema
  - name: Notificaciones
    description: Sistema de notificaciones
  - name: Mensajer√≠a
    description: Sistema de mensajer√≠a entre pacientes y m√©dicos
  - name: B√∫squeda
    description: B√∫squeda avanzada de m√©dicos y ex√°menes
  - name: Administraci√≥n
    description: Endpoints administrativos (solo para admins) 