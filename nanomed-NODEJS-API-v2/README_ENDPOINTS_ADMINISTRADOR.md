# üìã Endpoints de Administrador - Implementaci√≥n Frontend

## Estado de Implementaci√≥n

> **Nota:** El estado de cada endpoint se actualiza autom√°ticamente seg√∫n la tabla maestra de endpoints (`LISTADO_ENDPOINTS.md`).

---

## Endpoints de Administraci√≥n

### 1. **Gesti√≥n de Usuarios**

#### `GET /api/admin/users`
**Descripci√≥n**: Listar todos los usuarios con filtros
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const listarUsuarios = async (filters?: {
  role?: string;
  activo?: boolean;
  email_verified?: boolean;
}) => {
  const params = new URLSearchParams();
  Object.entries(filters || {}).forEach(([key, value]) => {
    if (value !== undefined) params.append(key, value.toString());
  });
  
  const response = await fetch(`/api/admin/users?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

#### `GET /api/admin/users/{id}`
**Descripci√≥n**: Obtener detalle completo de usuario
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const obtenerUsuarioCompleto = async (userId: number) => {
  const response = await fetch(`/api/admin/users/${userId}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

#### `PUT /api/admin/users/{id}`
**Descripci√≥n**: Actualizar usuario
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const actualizarUsuario = async (userId: number, userData: {
  nombre?: string;
  apellido?: string;
  email?: string;
  password?: string;
  telefono?: string;
  rut?: string;
  role?: 'user' | 'medico' | 'admin' | 'api';
  email_verified?: boolean;
  genero?: string;
}) => {
  const response = await fetch(`/api/admin/users/${userId}`, {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(userData)
  });
  return response.json();
};
```

#### `DELETE /api/admin/users/{id}`
**Descripci√≥n**: Desactivar usuario
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const desactivarUsuario = async (userId: number) => {
  const response = await fetch(`/api/admin/users/${userId}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 2. **Gesti√≥n de M√©dicos**

#### `GET /api/admin/doctors`
**Descripci√≥n**: Listar todos los m√©dicos con filtros
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const listarMedicos = async (filters?: {
  especialidad?: string;
  activo?: boolean;
}) => {
  const params = new URLSearchParams();
  Object.entries(filters || {}).forEach(([key, value]) => {
    if (value !== undefined) params.append(key, value.toString());
  });
  
  const response = await fetch(`/api/admin/doctors?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

#### `POST /api/admin/doctors`
**Descripci√≥n**: Crear nuevo m√©dico
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const crearMedico = async (medicoData: {
  nombre: string;
  apellido: string;
  email: string;
  password: string;
  especialidad: string;
  telefono?: string;
  rut?: string;
  fecha_nacimiento?: string;
  genero?: string;
}) => {
  const response = await fetch('/api/admin/doctors', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(medicoData)
  });
  return response.json();
};
```

#### `PUT /api/admin/doctors/{id}`
**Descripci√≥n**: Actualizar m√©dico
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const actualizarMedico = async (medicoId: number, medicoData: {
  nombre?: string;
  apellido?: string;
  email?: string;
  especialidad?: string;
  telefono?: string;
  activo?: boolean;
}) => {
  const response = await fetch(`/api/admin/doctors/${medicoId}`, {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(medicoData)
  });
  return response.json();
};
```

#### `DELETE /api/admin/doctors/{id}`
**Descripci√≥n**: Desactivar m√©dico
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const desactivarMedico = async (medicoId: number) => {
  const response = await fetch(`/api/admin/doctors/${medicoId}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 3. **Gesti√≥n de Recepcionistas**

#### `GET /api/admin/recepcionistas`
**Descripci√≥n**: Listar todos los recepcionistas
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const listarRecepcionistas = async (filters?: {
  email_verified?: boolean;
  activo?: boolean;
  search?: string;
}) => {
  const params = new URLSearchParams();
  Object.entries(filters || {}).forEach(([key, value]) => {
    if (value !== undefined) params.append(key, value.toString());
  });
  
  const response = await fetch(`/api/admin/recepcionistas?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 4. **Gesti√≥n de Administradores**

#### `GET /api/admin/admin`
**Descripci√≥n**: Listar todos los administradores
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const listarAdministradores = async (filters?: {
  activo?: boolean;
}) => {
  const params = new URLSearchParams();
  Object.entries(filters || {}).forEach(([key, value]) => {
    if (value !== undefined) params.append(key, value.toString());
  });
  
  const response = await fetch(`/api/admin/admin?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 5. **Creaci√≥n de Usuarios con Roles Especiales**

#### `POST /api/admin/users/medico`
**Descripci√≥n**: Crear nuevo usuario m√©dico
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const crearUsuarioMedico = async (userData: {
  nombre: string;
  apellido: string;
  email: string;
  password: string;
  telefono?: string;
  rut?: string;
  fecha_nacimiento?: string;
  genero?: string;
}) => {
  const response = await fetch('/api/admin/users/medico', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(userData)
  });
  return response.json();
};
```

#### `POST /api/admin/users/recepcionista`
**Descripci√≥n**: Crear nuevo usuario recepcionista
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const crearUsuarioRecepcionista = async (userData: {
  nombre: string;
  apellido: string;
  email: string;
  password: string;
  telefono?: string;
  rut?: string;
  fecha_nacimiento?: string;
  genero?: string;
}) => {
  const response = await fetch('/api/admin/users/recepcionista', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(userData)
  });
  return response.json();
};
```

#### `POST /api/admin/users/admin`
**Descripci√≥n**: Crear nuevo usuario administrador
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const crearUsuarioAdmin = async (userData: {
  nombre: string;
  apellido: string;
  email: string;
  password: string;
  telefono?: string;
  rut?: string;
  fecha_nacimiento?: string;
  genero?: string;
}) => {
  const response = await fetch('/api/admin/users/admin', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(userData)
  });
  return response.json();
};
```

#### `POST /api/admin/users/api`
**Descripci√≥n**: Crear nuevo usuario API
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const crearUsuarioApi = async (userData: {
  nombre: string;
  apellido: string;
  email: string;
  password: string;
  telefono?: string;
  rut?: string;
  fecha_nacimiento?: string;
  genero?: string;
}) => {
  const response = await fetch('/api/admin/users/api', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(userData)
  });
  return response.json();
};
```

### 6. **Gesti√≥n de Citas**

#### `GET /api/admin/appointments`
**Descripci√≥n**: Ver todas las citas con filtros
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const verTodasLasCitas = async (filters?: {
  estado?: string;
  medico_id?: number;
  fecha_desde?: string;
  fecha_hasta?: string;
}) => {
  const params = new URLSearchParams();
  Object.entries(filters || {}).forEach(([key, value]) => {
    if (value !== undefined) params.append(key, value.toString());
  });
  
  const response = await fetch(`/api/admin/appointments?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 7. **Estad√≠sticas del Sistema**

#### `GET /api/admin/stats`
**Descripci√≥n**: Obtener estad√≠sticas completas del sistema
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const obtenerEstadisticas = async () => {
  const response = await fetch('/api/admin/stats', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 8. **Gesti√≥n de Logs del Sistema**

#### `GET /api/admin/logs`
**Descripci√≥n**: Obtener logs del sistema
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const obtenerLogs = async (filters?: {
  nivel?: string;
  fecha_desde?: string;
  fecha_hasta?: string;
  limite?: number;
}) => {
  const params = new URLSearchParams();
  Object.entries(filters || {}).forEach(([key, value]) => {
    if (value !== undefined) params.append(key, value.toString());
  });
  
  const response = await fetch(`/api/admin/logs?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

### 9. **Migraci√≥n de M√©dicos**

#### `GET /api/admin/doctors/migration/status`
**Descripci√≥n**: Obtener estado de migraci√≥n de m√©dicos
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const obtenerEstadoMigracion = async () => {
  const response = await fetch('/api/admin/doctors/migration/status', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.json();
};
```

#### `POST /api/admin/doctors/migration/execute`
**Descripci√≥n**: Ejecutar migraci√≥n de m√©dicos
**Rol**: Administrador
**Estado**: ‚ùå No implementado en frontend

```typescript
// Implementaci√≥n requerida
const ejecutarMigracion = async (migrationData?: {
  batch_size?: number;
  dry_run?: boolean;
}) => {
  const response = await fetch('/api/admin/doctors/migration/execute', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(migrationData || {})
  });
  return response.json();
};
```

---

## üõ†Ô∏è Consideraciones T√©cnicas

### **Autenticaci√≥n**
Todos los endpoints requieren token JWT en el header:
```typescript
headers: {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
}
```

### **Manejo de Errores**
```typescript
// Ejemplo de manejo de errores
const handleApiError = (error: any) => {
  if (error.status === 401) {
    // Redirigir a login
    router.push('/login');
  } else if (error.status === 403) {
    // Mostrar error de permisos
    toast.error('No tienes permisos para realizar esta acci√≥n');
  } else {
    // Error general
    toast.error('Error en el servidor');
  }
};
```

### **Validaciones de Datos**
Los endpoints incluyen validaciones autom√°ticas para:
- Formato de email
- Contrase√±as seguras (m√≠nimo 8 caracteres, may√∫sculas, min√∫sculas, n√∫meros, caracteres especiales)
- Formato de RUT chileno
- Formato de tel√©fono chileno
- Fechas v√°lidas
- Roles permitidos

---

## üì± Componentes Frontend Sugeridos

### **Gesti√≥n de Usuarios** ‚ùå
- `AdminUsersList.tsx` - Lista de todos los usuarios
- `UserDetail.tsx` - Detalle completo de usuario
- `UserEditForm.tsx` - Formulario para editar usuario
- `UserDeactivateModal.tsx` - Modal para desactivar usuario

### **Gesti√≥n de M√©dicos** ‚ùå
- `AdminDoctorsList.tsx` - Lista de todos los m√©dicos
- `DoctorCreateForm.tsx` - Formulario para crear m√©dico
- `DoctorEditForm.tsx` - Formulario para editar m√©dico
- `DoctorDeactivateModal.tsx` - Modal para desactivar m√©dico

### **Gesti√≥n de Recepcionistas** ‚ùå
- `AdminReceptionistsList.tsx` - Lista de recepcionistas
- `ReceptionistDetail.tsx` - Detalle de recepcionista

### **Gesti√≥n de Administradores** ‚ùå
- `AdminAdministratorsList.tsx` - Lista de administradores
- `AdministratorDetail.tsx` - Detalle de administrador

### **üÜï Creaci√≥n de Usuarios** ‚ùå
- `CreateUserForm.tsx` - Formulario gen√©rico para crear usuarios
- `CreateMedicoForm.tsx` - Formulario espec√≠fico para m√©dicos
- `CreateReceptionistForm.tsx` - Formulario espec√≠fico para recepcionistas
- `CreateAdminForm.tsx` - Formulario espec√≠fico para administradores
- `CreateApiUserForm.tsx` - Formulario espec√≠fico para usuarios API

### **üÜï Gesti√≥n de Citas** ‚ùå
- `AdminAppointmentsList.tsx` - Lista de todas las citas
- `AppointmentFilters.tsx` - Filtros para citas
- `AppointmentDetail.tsx` - Detalle de cita espec√≠fica

### **üÜï Estad√≠sticas del Sistema** ‚ùå
- `SystemStats.tsx` - Dashboard de estad√≠sticas
- `StatsCards.tsx` - Tarjetas de estad√≠sticas
- `StatsCharts.tsx` - Gr√°ficos de estad√≠sticas
- `TopSpecialtiesChart.tsx` - Gr√°fico de especialidades m√°s solicitadas

### **üÜï Gesti√≥n de Logs** ‚ùå
- `SystemLogs.tsx` - Lista de logs del sistema
- `LogFilters.tsx` - Filtros para logs
- `LogDetail.tsx` - Detalle de log espec√≠fico

### **üÜï Migraci√≥n de M√©dicos** ‚ùå
- `MigrationStatus.tsx` - Estado de migraci√≥n
- `MigrationExecute.tsx` - Ejecutar migraci√≥n
- `MigrationProgress.tsx` - Progreso de migraci√≥n

### **üÜï Gesti√≥n Avanzada de M√©dicos** ‚ùå
- `DoctorLegacyCreate.tsx` - Crear m√©dico legacy
- `DoctorDeactivateModal.tsx` - Modal para desactivar m√©dico

---

## üéØ Prioridades de Implementaci√≥n

### **Alta Prioridad** (Funcionalidad Core)
1. `GET /api/admin/users` - Listar usuarios
2. `GET /api/admin/stats` - Estad√≠sticas del sistema
3. `POST /api/admin/users/medico` - Crear m√©dicos
4. `GET /api/admin/doctors` - Listar m√©dicos
5. `PUT /api/admin/users/{id}` - Actualizar usuarios

### **Media Prioridad** (Funcionalidad secundaria)
6. `GET /api/admin/users/{id}` - Detalle de usuario
7. `DELETE /api/admin/users/{id}` - Desactivar usuarios
8. `POST /api/admin/users/recepcionista` - Crear recepcionistas
9. `GET /api/admin/recepcionistas` - Listar recepcionistas
10. `POST /api/admin/users/admin` - Crear administradores

### **Baja Prioridad** (Funcionalidad adicional)
11. `GET /api/admin/admin` - Listar administradores
12. `POST /api/admin/users/api` - Crear usuarios API
13. `GET /api/admin/logs` - Obtener logs del sistema
14. `GET /api/admin/doctors/migration/status` - Estado de migraci√≥n
15. `POST /api/admin/doctors/migration/execute` - Ejecutar migraci√≥n
16. `POST /api/admin/doctors` - Crear m√©dicos legacy
17. `DELETE /api/admin/doctors/{id}` - Desactivar m√©dicos
18. `GET /api/admin/appointments` - Ver todas las citas

---

## üìã Checklist de Implementaci√≥n

### ‚ùå **Pendientes** (18/18)
- [ ] **Gesti√≥n de Usuarios** (4/4 endpoints)
  - [ ] Listar todos los usuarios
  - [ ] Obtener detalle de usuario
  - [ ] Actualizar usuario
  - [ ] Desactivar usuario

- [ ] **Gesti√≥n de M√©dicos** (3/3 endpoints)
  - [ ] Listar todos los m√©dicos
  - [ ] Crear nuevo m√©dico
  - [ ] Actualizar m√©dico

- [ ] **Gesti√≥n de Recepcionistas** (1/1 endpoint)
  - [ ] Listar recepcionistas

- [ ] **Gesti√≥n de Administradores** (1/1 endpoint)
  - [ ] Listar administradores

- [ ] **üÜï Creaci√≥n de Usuarios Especiales** (4/4 endpoints)
  - [ ] Crear usuario m√©dico
  - [ ] Crear usuario recepcionista
  - [ ] Crear usuario administrador
  - [ ] Crear usuario API

- [ ] **üÜï Gesti√≥n de Citas** (1/1 endpoint)
  - [ ] Ver todas las citas

- [ ] **üÜï Estad√≠sticas del Sistema** (1/1 endpoint)
  - [ ] Obtener estad√≠sticas completas

- [ ] **üÜï Gesti√≥n de Logs** (1/1 endpoint)
  - [ ] Obtener logs del sistema

- [ ] **üÜï Migraci√≥n de M√©dicos** (2/2 endpoints)
  - [ ] Obtener estado de migraci√≥n
  - [ ] Ejecutar migraci√≥n

- [ ] **üÜï Gesti√≥n Avanzada de M√©dicos** (2/2 endpoints)
  - [ ] Crear m√©dico legacy
  - [ ] Desactivar m√©dico

---

**√öltima actualizaci√≥n**: Julio 2025  
**Versi√≥n**: 3.0 - Estado actualizado seg√∫n LISTADO_ENDPOINTS.md 